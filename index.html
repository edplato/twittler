<!DOCTYPE html>
<html>
  <head>
    <link href="https://fonts.googleapis.com/css?family=Lato:300,400" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" type="text/css" href="style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.18.1/moment.min.js"></script>
    <script src="jquery.js"></script>
    <script src="data_generator.js"></script>
  </head>
  <body>

  <!-- Header -->

  <header class="global-header">
      <div class="container group">

      <nav class="nav left-nav">
        <ul>
          <li><a href="#"><i class="fa fa-home fa-lg fa-fw" aria-hidden="true"></i>Home</a></li><!--
          --><li><a href="#"><i class="fa fa-bolt fa-lg fa-fw" aria-hidden="true"></i>Moments</a></li><!--
          --><li><a href="#"><i class="fa fa-bell fa-lg fa-fw" aria-hidden="true"></i>Notifications</a></li><!--
          --><li><a href="#"><i class="fa fa-envelope fa-lg fa-fw" aria-hidden="true"></i>Messages</a></li>
        </ul>
      </nav>

      <a href="#"><i class="fa fa-twitter fa-2x twitterLogo" aria-hidden="true"></i></a>
     
      <nav class="nav right-nav">
        <ul>
          <li><div><form class="form-search">
            <input class="header-search" type="text" placeholder="Search Twittler" name="searchBox"><i class="fa fa-search search-icon" aria-hidden="true"></i>
          </form></div></li><!--
          --><li><a href="#"><img class="header-profile-pic" src="assets/images/eaplato.jpg" alt="Ed Plato"></a></li><!--
          --><li><button class="header-tweet-button">Tweet</button></li>
        </ul>
      </nav>

      </div>

  </header>

  <!-- Feed Content Container -->
  <div class="header-poster"><img src='assets/images/arm-sound-retro-audio-19951.jpg' id="poster-pic"></div>
  <div class="header-bar"></div>

  <div class="container feed-content">


    <section class="col left-col">

       <div class="col-content card">
            <img src="assets/images/eaplato.jpg" alt="Ed Plato" id="card-pic">
              <ul>
                <li><a href="https://twitter.com/eaplato" id="card-userNameLink">Ed Plato</a></li>
                <li><a href="https://twitter.com/eaplato" id="card-userHandleLink">@eaplato</a></li>
              </ul>
              <p id="card-profileDescription">The Official Twittler Page of Ed Plato</p>
       </div>

       <div class="col-content trends">
       <ul>
                <li class="tweetDetails eaplato">eaplato</li>

                <li class="tweetDetails mracus">mracus</li>

                <li class="tweetDetails sharksforcheap">sharksforcheap</li>

                <li class="tweetDetails shawndrost">shawndrost</li>

                <li class="tweetDetails douglascalhoun">douglascalhoun</li>

       </ul>

       </div>

    </section>

    <section class="col tweet-stream">

      <ul>  
        <li class="first"></li>
      </ul>

    </section>

    <section class="col right-col">

      <div class="col-content who-to-follow">
        <div class="who-to-follow-header"><span>Who to follow</span> &middot;<a href="#">Refresh</a>&middot;<a href="#">View All</a></div>
      </div>

      <div class="col-content legal">
        <p>&copy; 2017 Twittler <a href="#">About</a> <a href="#">Help Center</a> <a href="#">Terms</a> <a href="#">Privacy policy</a> <a href="#">Cookies</a> <a href="#">Ads info</a> <a href="#">Brand</a> <a href="#">Blog</a> <a href="#">Status</a> <a href="#">Apps</a> <a href="#">Jobs</a> <a href="#">Businesses</a> <a href="#">Developers</a></p>
      </div>

      <div class="col-content advertise">
        <a class="advertise" href="#"><i class="fa fa-check-square-o fa-fw" aria-hidden="true"></i>Advertise with Twittler</a>
      </div>

    </section>

  </div>

    <script>

      $(document).ready(function(){
        
        // add global user info

        var $users = streams.users;

        $users.eaplato = [];
        $users.eaplato.poster = 'assets/images/arm-sound-retro-audio-19951.jpg';
        $users.eaplato.cardpic = 'assets/images/eaplato.jpg';
        $users.eaplato.userName = 'Ed Plato';     

        $users.mracus.poster = 'assets/images/pexels-photo-462443.jpeg';
        $users.mracus.cardpic = 'assets/images/mracus.jpeg';
        $users.mracus.userName = 'Marcus Phillips';
        
        $users.sharksforcheap.poster = 'assets/images/pexels-photo-433604.jpeg';
        $users.sharksforcheap.cardpic = 'assets/images/sharksforcheap.jpeg';
        $users.sharksforcheap.userName = 'Anthony Phillips';

        $users.shawndrost.poster = 'assets/images/pexels-photo-374777.jpeg';
        $users.shawndrost.cardpic = 'assets/images/shawndrost.jpg';
        $users.shawndrost.userName = 'Shawn Drost';

        $users.douglascalhoun.poster = 'assets/images/pexels-photo-327231.jpeg';
        $users.douglascalhoun.cardpic = 'assets/images/douglascalhoun.jpg';
        $users.douglascalhoun.userName = 'Douglas Calhoun';

        var $body = $('body');
        var $ul = $('ul');
        
        var index = 0;
        var streamRestrict = false;
        var currentUser = '';
        
        // constant stream interval to grab new tweets
        setInterval(function() {
          // if new tweets run low, delay stream
          if(streams.home.length - 5 <= index){
            setTimeout(function(){
            }, 1500);
          } else {
          let $first = $('.first');

          if(streamRestrict){
            var tweet = streams.users[currentUser][index];
          } else {
            var tweet = streams.home[index];
          }

          var timeTweetedInput = tweet.created_at.toString();
          var reformatDate = timeTweetedInput.slice(4, 24);
          var timeAgo = moment(reformatDate, 'MMM DD YYYY h:mma ZZ').fromNow();

          var $tweetDetails = $(
            '<li class="tweetDetails ' + tweet.user + ' tweetVisibility"><div><strong>' + $users[tweet.user].userName + '</strong> <span class="userHandle">@' + tweet.user + '</span> &middot; ' + timeAgo + '</div>' 
            +'<div>'+ tweet.message + '</div></li>');

          $first.prepend($tweetDetails);

          index++;
          }
        }, 2500);

        // faux page change on user click 

        $('.tweetDetails').on('click', function() {
          console.log('clicked');
          let getUserName = $(this).attr('class').split(' ')[1];

          $('#card-pic').fadeOut(275, function() {
            $('#card-pic').attr('src', $users[getUserName].cardpic);
            $('#card-pic').attr('alt', $users[getUserName].userName);            
            $('#card-pic').fadeTo(500, 1);
          });

          $('#card-userNameLink, #card-userHandleLink, #card-profileDescription').fadeOut(275, function() {
            let userTwitterLink = 'https://twitter.com/' + getUserName;
            $('#card-userNameLink, #card-userHandleLink').attr('href', userTwitterLink)
            $('#card-userNameLink').text($users[getUserName].userName)
            $('#card-userHandleLink').text('@'+getUserName)
            $('#card-profileDescription').text('The Official Twittler Page of ' + $users[getUserName].userName);
            $('#card-userNameLink, #card-userHandleLink, #card-profileDescription').fadeTo(300, 1);
          });

          $('#poster-pic').fadeOut(50, function() {
            $('#poster-pic').attr('src', $users[getUserName].poster);
            $('#poster-pic').fadeTo(500, 1);
          });

          $('.tweetVisibility').not('.' + getUserName).hide();
          showPage(getUserName);
        });

        function showPage(input){
          let startingStreamLength = streams.users[input].length;
          setStreamRestriction(input);

          for(var i = 0; i < startingStreamLength; i++){
              let $first = $('.first');

              var tweet = streams.users[input][i];

              var timeTweetedInput = tweet.created_at.toString();
              var reformatDate = timeTweetedInput.slice(4, 24);
              var timeAgo = moment(reformatDate, 'MMM DD YYYY h:mma ZZ').fromNow();

              var $tweetDetails = $(
                '<li class="tweetDetails ' + input + ' tweetVisibility"><div><strong>' + $users[input].userName + '</strong> <span class="userHandle">@' + input + '</span> &middot; ' + timeAgo + '</div>' 
                +'<div>'+ tweet.message + '</div></li>');

              $first.prepend($tweetDetails);
          }
        };

        function setStreamRestriction(inputName){
          streamRestrict = true;
          currentUser = inputName;
        };

      });

    </script>
  </body>
</html>
